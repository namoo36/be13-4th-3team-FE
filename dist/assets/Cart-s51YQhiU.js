import{_ as w,i as O,x as D,A as P,a as _,o as b,d as s,p as C,f as u,D as $,F as Q,k as A,t as p,v as B,z as S,y as h,m as L,l as N,B as R,j as T,e as q,P as V}from"./index-BaYYEV3U.js";import{u as F}from"./cartStores-G-R677xd.js";const j={class:"cart-wrapper py-4"},z={class:"d-flex justify-content-between align-items-center mb-3 border-bottom pb-2"},E={class:"col-md-1"},M=["onUpdate:modelValue"],G={class:"row mb-3 border-bottom pb-3 align-items-center"},H={class:"col-md-2"},J=["src"],K={class:"col-md-5"},W=["onClick"],X={class:"mb-0 text-muted"},Y={class:"text-danger"},Z={class:"col-md-2 text-end"},ee=["onUpdate:modelValue","onChange"],te={class:"col-md-2 text-end"},se={class:"fw-bold"},ae={class:"small"},ne=["onClick"],oe={class:"bg-light p-3 rounded d-flex justify-content-between align-items-center"},re={class:"me-3"},ce={class:"text-success"},le="https://yygang-bucket.s3.ap-northeast-2.amazonaws.com/SupplementCharactor.png",ie={__name:"CartForm",props:{cartOptions:Array},emits:["update-quantity","delete-item"],setup(x,{emit:m}){const k=F(),g=S(),l=x,i=m,r=O([]);D(()=>l.cartOptions,async t=>{if(Array.isArray(t)){console.log(t),r.value=t.map(e=>({...e,checked:!1}));for(let e of t){const a=await h.get(`/nsupplement/productImage/${e.nsupplementId}`);e.productImage=a.data}console.log(t)}else r.value=[]},{immediate:!0,deep:!0});const f=P({get:()=>r.value.every(t=>t.checked),set:t=>{r.value.forEach(e=>e.checked=t)}}),v=P(()=>r.value.filter(t=>t.checked).reduce((t,e)=>t+(e.itemPrice||0)*(e.quantity||0),0)),d=t=>t.toLocaleString()+"원",I=()=>{const t=f.value;r.value.forEach(e=>e.checked=t)},n=(t,e)=>{const a=parseInt(e);if(a<1){alert("최소 수량은 1개입니다.");return}const c=r.value.find(U=>U.cartOptionId===t);if(c){if(a>c.stockQuantity){alert(`재고는 ${c.stockQuantity}개까지 가능합니다.`),c.quantity=c.stockQuantity;return}i("update-quantity",t,a)}},o=()=>{const t=r.value.filter(e=>e.checked).map(e=>e.cartOptionId);if(t.length===0){alert("선택된 항목이 없습니다.");return}i("delete-selected",t)},y=()=>{const t=r.value.filter(e=>e.checked);if(t.length===0){alert("선택된 항목이 없습니다.");return}console.log(t),k.setCartItems(t),g.push({name:"cartOrder"})};return(t,e)=>(b(),_("div",j,[s("div",z,[s("div",null,[C(s("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=a=>f.value=a),onChange:I},null,544),[[$,f.value]]),e[1]||(e[1]=u(" 전체 선택 "))]),s("button",{class:"btn btn-sm btn-outline-danger",onClick:o},"선택 삭제")]),(b(!0),_(Q,null,A(r.value,a=>(b(),_("div",{key:a.cartOptionId,class:"mb-4 p-3 border rounded"},[s("div",E,[C(s("input",{type:"checkbox","onUpdate:modelValue":c=>a.checked=c},null,8,M),[[$,a.checked]])]),s("div",G,[s("div",H,[s("img",{src:a.productImage||le,class:"img-fluid rounded"},null,8,J)]),s("div",K,[s("p",{class:"fw-bold mb-1 text-primary",style:{cursor:"pointer"},onClick:c=>t.$emit("item-click",a.nsupplementId)},p(a.nsupplementName),9,W),s("p",X,p(a.brand),1),s("span",Y,p(d(a.itemPrice)),1)]),s("div",Z,[e[2]||(e[2]=s("label",{for:"qty"},"수량",-1)),C(s("input",{type:"number","onUpdate:modelValue":c=>a.quantity=c,onChange:c=>n(a.cartOptionId,a.quantity),class:"form-control form-control-sm",style:{width:"70px",display:"inline-block"},min:"1"},null,40,ee),[[B,a.quantity,void 0,{number:!0}]])]),s("div",te,[s("p",se,[e[3]||(e[3]=u("총 금액")),e[4]||(e[4]=s("br",null,null,-1)),u(p(d(a.itemPrice*a.quantity)),1)]),s("p",ae,"배송비 "+p(a.shippingFee?d(a.shippingFee):"무료"),1),s("button",{class:"btn btn-outline-danger btn-sm mt-2",onClick:c=>t.$emit("delete-item",a.cartOptionId)},"삭제",8,ne)])])]))),128)),s("div",oe,[s("div",null,[s("span",re,[e[5]||(e[5]=u("선택상품금액 ")),s("strong",null,p(d(v.value)),1)]),e[7]||(e[7]=s("span",{class:"me-3"},[u("총 배송비 "),s("strong",null,"0원")],-1)),e[8]||(e[8]=s("span",{class:"me-3"},[u("즉시할인예상금액 "),s("strong",{class:"text-danger"}," 0원 ")],-1)),s("span",null,[e[6]||(e[6]=u("주문금액 ")),s("strong",ce,p(d(v.value)),1)])]),s("button",{class:"btn btn-success",onClick:y},"선택 상품 주문하기")])]))}},de=w(ie,[["__scopeId","data-v-4908d4a8"]]),ue={class:"cart-container"},pe={__name:"Cart",setup(x){F();const m=O([]),k=N(),g=S(),l=L({currentPage:parseInt(k.query.page)||1,totalCount:0,pageLimit:5,listLimit:10}),i=async n=>{try{const o=await h.get(`/cart?page=${n}&size=${l.listLimit}`);m.value=o.data.cartOptions,l.currentPage=n,l.totalCount=o.data.totalCount}catch(o){o.response.data.code===404?(alert(o.response.data.message),g.push({name:"cart"})):alert("장바구니 조회 중 에러가 발생했습니다.")}},r=({page:n,totalPages:o})=>{n>=1&&n<=o&&g.push({name:"cart",query:{page:n}})},f=n=>{if(!n)return alert("상품 ID가 없습니다.");g.push({name:"nsupplement/no",params:{no:n}})},v=async n=>{if(confirm("정말로 삭제하시겠습니까?"))try{await h.delete(`/cart/${n}`),alert("장바구니에서 삭제되었습니다."),i(l.currentPage)}catch(o){o.response.data.code===404?(alert(o.response.data.message),g.push({name:"cart"})):alert("삭제 중 에러가 발생했습니다.")}},d=async n=>{if(confirm("선택된 상품을 삭제하시겠습니까?"))try{await Promise.all(n.map(o=>h.delete(`/cart/${o}`))),alert("선택한 상품이 모두 삭제되었습니다."),i(l.currentPage)}catch(o){console.error("선택 삭제 중 오류:",o),alert("선택 삭제 중 오류가 발생했습니다.")}},I=async(n,o)=>{try{const t=(await h.put(`/cart/${n}?quantity=${o}`)).data,e=m.value.findIndex(a=>a.cartOptionId===t.cartOptionId);e!==-1&&(m.value[e]=t)}catch(y){const t=y.response.data.code,e=y.response.data.message;if(t===404)switch(e){case"장바구니가 비었습니다.":case"등록된 상품이 없습니다.":alert(e);break}else alert(t===400?e:"에러가 발생했습니다.")}};return R((n,o)=>{l.currentPage=parseInt(n.query.page)||1,i(l.currentPage)}),T(()=>{i(l.currentPage)}),(n,o)=>(b(),_("main",ue,[q(de,{"cart-options":m.value,onUpdateQuantity:I,onDeleteItem:v,onDeleteSelected:d,onItemClick:f},null,8,["cart-options"]),q(V,{pageInfo:l,onChangePage:r},null,8,["pageInfo"])]))}},fe=w(pe,[["__scopeId","data-v-8b4022b4"]]);export{fe as default};
