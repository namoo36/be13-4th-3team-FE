import{_ as H,u as O,m as Y,i as d,j as q,l as G,a as i,d as e,t as n,g,h as f,p as I,v as D,F as x,k as L,y as c,z as J,o as l,f as E,E as P}from"./index-BaYYEV3U.js";const Q={id:"mainArea"},W={id:"boardArea"},X={style:{"font-weight":"bold"}},Z={id:"boardInfo"},tt={id:"boardContent"},et={id:"btnArea"},st={class:"mt-2 p-3 bg-body rounded shadow-sm"},ot={id:"h2Div"},nt={class:"fs-6"},at={class:"d-flex justify-content-end"},rt={id:"commentArea"},it={class:"comment-header"},lt=["onClick"],dt={class:"comment-user"},ct={class:"comment-date"},ut={class:"comment-content"},mt={key:0,class:"reply-form"},pt=["onKeyup"],vt=["onClick"],ht={class:"child-comment-header"},bt={class:"comment-user"},ft={class:"comment-date"},yt={class:"child-comment-content"},_t={__name:"BoardDetail",setup(kt){const C=O(),$=C.isLoggedIn,w=C.userInfo,u=J(),m=G(),a=Y({}),v=d([]),h=d(""),p=d(""),b=d(null),y=d(!1);d("white");const S=d(0);localStorage.getItem("userInfo");const V=async s=>{try{const t=await c.get(`/board/${s}/likes`);S.value=t.data}catch(t){console.error("좋아요 개수 불러오기 실패",t)}},M=async s=>{try{const t=await c.get(`/like/${s}`);y.value=!!t.data}catch(t){console.error("좋아요 정보 불러오기 실패",t)}},B=async()=>{try{const s=await c.post(`/like/${m.params.id}`);if(s&&s.data)y.value=s.data==="좋아요 등록",await V(m.params.id);else throw new Error("서버 응답이 없습니다.")}catch(s){console.error("좋아요 처리 오류",s),alert("좋아요 처리 중 오류가 발생했습니다.")}},N=async s=>{try{const t=await c.get(`/board/${s}`);Object.assign(a,t.data)}catch{}},A=async s=>{try{const t=await c.get(`/board/${s}/comment`);v.value=await t.data}catch{}},R=s=>{b.value=b.value===s?null:s,p.value=""},_=async s=>{const t=s?p.value:h.value;if(!t.trim())return alert("댓글을 입력하세요!");try{(await c.post(`/board/${a.id}/comment`,{content:t.trim()},{params:s?{parentId:s}:{}})).status===201&&(await A(a.id),s?(p.value="",b.value=null):h.value="")}catch{alert("댓글을 추가하는 중 오류가 발생했습니다.")}},T=async s=>{try{confirm("삭제하시겠습니까?")?(await c.delete(`/board/${s}`)).status===200&&(alert("삭제되었습니다."),u.push({name:"board"})):u.back()}catch(t){t.response.data.code===403?alert("삭제 권한이 없습니다"):t.response.data.code===404?(alert("게시글 삭제 중 오류가 발생했습니다."),u.push({name:"departments"})):alert(`게시글 삭제 오류", ${t}`)}},j=()=>{u.push({name:"board"})},F=s=>{u.push({name:"board/edit/id",params:{id:s}})},k=s=>{const t=new Date(s),o=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),K=String(t.getDate()).padStart(2,"0"),U=String(t.getHours()).padStart(2,"0"),z=String(t.getMinutes()).padStart(2,"0");return`${o}-${r}-${K} ${U}:${z}`};return q(function(){N(m.params.id),A(m.params.id),M(m.params.id)}),(s,t)=>(l(),i("main",null,[e("div",Q,[e("div",W,[e("div",null,[e("h3",X,n(a.title),1)]),e("div",Z,[e("div",null,"작성자: "+n(a.userName)+" | 작성일: "+n(k(a.createdAt)),1),e("div",null,[y.value?(l(),i("i",{key:0,class:"bi bi-heart-fill",style:{color:"red"},onClick:t[0]||(t[0]=o=>B())})):(l(),i("i",{key:1,class:"bi bi-heart",onClick:t[1]||(t[1]=o=>B())})),e("i",null,n(S.value),1)])]),e("div",tt,n(a.content),1)]),e("div",et,[f($)&&f(w).username===a.userEmail?(l(),i("button",{key:0,class:"btn btn-success",onClick:t[2]||(t[2]=o=>F(a.id))},"수정하기")):g("",!0),f($)&&f(w).username===a.userEmail?(l(),i("button",{key:1,class:"btn btn-success",onClick:t[3]||(t[3]=o=>T(a.id))},"삭제")):g("",!0),e("button",{onClick:j,class:"btn btn-success"},"뒤로가기")]),e("div",st,[e("div",ot,[t[7]||(t[7]=e("h2",{class:"fs-6"},"댓글 작성",-1)),e("h2",nt,"댓글 수: "+n(v.value.length),1)]),I(e("input",{class:"form-control",type:"text","onUpdate:modelValue":t[4]||(t[4]=o=>h.value=o)},null,512),[[D,h.value,void 0,{trim:!0}]]),t[11]||(t[11]=e("div",{class:"form-text"},"존중과 배려하는 마음으로 건강한 댓글 문화를 함께 만들어가요.",-1)),e("div",at,[e("button",{class:"btn btn-success",onClick:t[5]||(t[5]=o=>_(v.value.id))},"등록")]),e("div",rt,[(l(!0),i(x,null,L(v.value,o=>(l(),i("div",{key:o.id,class:"comment-item"},[e("div",it,[e("span",{onClick:r=>R(o.id),class:"comment-info"},[e("span",dt,n(o.userId),1),t[8]||(t[8]=E(" | ")),e("span",ct,n(k(o.createdAt)),1)],8,lt),t[9]||(t[9]=e("br",null,null,-1)),e("strong",ut,n(o.content),1)]),b.value===o.id?(l(),i("div",mt,[I(e("input",{class:"form-control",type:"text","onUpdate:modelValue":t[6]||(t[6]=r=>p.value=r),onKeyup:P(r=>_(o.id),["enter"]),placeholder:"답글을 입력하세요..."},null,40,pt),[[D,p.value,void 0,{trim:!0}]]),e("button",{class:"btn btn-sm btn-outline-success mt-1",onClick:r=>_(o.id)},"답글 등록",8,vt)])):g("",!0),(l(!0),i(x,null,L(o.childComments,r=>(l(),i("div",{key:r.id,class:"child-comment"},[e("div",ht,[e("span",bt,n(r.userId),1),t[10]||(t[10]=E(" | ")),e("span",ft,n(k(r.createdAt)),1)]),e("strong",yt,n(r.content),1)]))),128))]))),128))])])])]))}},Ct=H(_t,[["__scopeId","data-v-1b58059f"]]);export{Ct as default};
